<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cricket Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'primary': '#1D4ED8',
              'secondary': '#1E3A8A',
              'accent': '#3B82F6',
              'neutral': '#1F2937',
              'base-100': '#F9FAFB',
              'info': '#0EA5E9',
              'success': '#10B981',
              'warning': '#F59E0B',
              'error': '#EF4444',
            }
          }
        }
      }
    </script>
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
    <script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-router-dom": "https://aistudiocdn.com/react-router-dom@^7.9.5"
  }
}
</script>
    <script src="https://unpkg.com/@babel/standalone@7.24.7/babel.min.js"></script>
  </head>
  <body class="bg-base-100 text-neutral">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
import React, { useState, useEffect, useCallback, useRef } from 'react';
import ReactDOM from 'react-dom/client';
import { HashRouter, Routes, Route, Outlet, Link, NavLink, useParams, useNavigate } from 'react-router-dom';

// --- Sample Posts Data ---
let posts_data = [
  {
    id: '1',
    title: 'The Rise of Modern Frontend Frameworks',
    content: '<p>In the ever-evolving landscape of web development, frontend frameworks have become essential tools for building complex and interactive user interfaces. This article explores the history and future of frameworks like React, Angular, and Vue.</p><img src="https://picsum.photos/seed/frameworks/800/400" alt="Code on a screen" /><p>We will delve into their core philosophies, performance characteristics, and community support to help you choose the right one for your next project.</p>',
    date: '2023-10-26',
  },
  {
    id: '2',
    title: 'Mastering TypeScript for Scalable Applications',
    content: '<p>TypeScript, a statically typed superset of JavaScript, brings type safety and advanced tooling to large-scale JavaScript projects. Discover how its features can help you write more maintainable and error-free code.</p><img src="https://picsum.photos/seed/typescript/800/400" alt="TypeScript code" /><p>This post covers everything from basic types to advanced concepts like generics and decorators.</p>',
    date: '2023-10-22',
  },
  {
    id: '3',
    title: 'The Art of UI/UX: Creating User-Centric Designs',
    content: '<p>A visually stunning application is only half the battle; a great user experience (UX) is what truly sets successful products apart. This article explores fundamental UI/UX principles for creating intuitive and delightful digital products.</p><p>We will cover user research, wireframing, prototyping, and accessibility best practices.</p><img src="https://picsum.photos/seed/uiux/800/400" alt="UI/UX design sketches" />',
    date: '2023-10-18',
  }
];

// --- Blog Service ---
let posts = [...posts_data];
const getPosts = async () => { await new Promise(res=>setTimeout(res,200)); return [...posts].sort((a,b)=>new Date(b.date)-new Date(a.date)); };
const getPostById = async (id) => { await new Promise(res=>setTimeout(res,200)); return posts.find(p=>p.id===id); };
const addPost = async (postData) => { await new Promise(res=>setTimeout(res,200)); const newPost={...postData,id:Date.now().toString(),date:new Date().toISOString().split('T')[0]}; posts.push(newPost); return newPost; };
const updatePost = async (id, postData) => { await new Promise(res=>setTimeout(res,200)); const idx=posts.findIndex(p=>p.id===id); if(idx>-1){posts[idx]={...posts[idx],...postData}; return posts[idx];} return undefined; };
const deletePost = async (id) => { await new Promise(res=>setTimeout(res,200)); const lenBefore=posts.length; posts=posts.filter(p=>p.id!==id); return posts.length<lenBefore; };

// --- Components ---
const Header = () => {
  const activeLinkStyle = { color:'#3B82F6', textDecoration:'underline' };
  return (
    <header className="bg-neutral shadow-md sticky top-0 z-50">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8 flex justify-between h-16 items-center">
        <Link to="/" className="text-2xl font-bold text-white hover:text-accent transition-colors">Cricket Hub</Link>
        <nav className="hidden md:block">
          <NavLink to="/" className="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium" style={({isActive})=>isActive?activeLinkStyle:undefined}>Home</NavLink>
        </nav>
      </div>
    </header>
  );
};

const Footer = () => (<footer className="bg-neutral text-white mt-auto"><div className="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center">&copy; {new Date().getFullYear()} Cricket Hub. All rights reserved.</div></footer>);

const PostCard = ({post})=>{
  const extractImageUrl = (htmlContent) => {
    if (!htmlContent) return 'https://picsum.photos/seed/placeholder/800/400';
    const match = htmlContent.match(/<img.*?src="([^"]+)"/);
    return match ? match[1] : 'https://picsum.photos/seed/placeholder/800/400';
  };

  const createExcerpt = (htmlContent, length = 120) => {
    if (!htmlContent) return '';
    const text = htmlContent.replace(/<[^>]+>/g, ' ').replace(/\s+/g, ' ').trim();
    return text.length > length ? text.substring(0, length) + '...' : text;
  };

  const imageUrl = extractImageUrl(post.content);
  const excerpt = createExcerpt(post.content);

  return (
    <div className="bg-white rounded-lg shadow-lg overflow-hidden transform hover:-translate-y-1 transition-transform duration-300">
      <Link to={`/post/${post.id}`} className="block">
        <img className="w-full h-48 object-cover" src={imageUrl} alt={post.title} />
        <div className="p-6">
          <h2 className="text-2xl font-bold mb-2 text-neutral hover:text-primary">{post.title}</h2>
          <p className="text-gray-500 text-sm mb-4">Posted on {new Date(post.date).toLocaleDateString()}</p>
          <p className="text-gray-700 leading-relaxed">{excerpt}</p>
        </div>
      </Link>
    </div>
  );
};

const PostList = () => {
  const [posts,setPosts]=useState([]); const [loading,setLoading]=useState(true);
  useEffect(()=>{ const fetchPosts=async()=>{ setLoading(true); const data=await getPosts(); setPosts(data); setLoading(false); }; fetchPosts(); },[]);
  if(loading) return <div className="flex justify-center items-center h-64"><div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-primary"></div></div>;
  return (
    <div>
      <h1 className="text-4xl font-extrabold text-center mb-12 text-neutral">Latest Articles</h1>
      <div className="grid gap-8 md:grid-cols-2 lg:grid-cols-3">{posts.map(p=><PostCard key={p.id} post={p}/>)}</div>
    </div>
  );
};

const PostDetail = () => {
  const {id}=useParams(); const [post,setPost]=useState(null); const [loading,setLoading]=useState(true);
  useEffect(()=>{ if(id){ const fetchPost=async()=>{ setLoading(true); const data=await getPostById(id); setPost(data||null); setLoading(false); }; fetchPost(); } },[id]);
  if(loading) return <div className="flex justify-center items-center h-64"><div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-primary"></div></div>;
  if(!post) return <div className="text-center py-10"><h2 className="text-2xl font-bold">Post not found</h2><Link to="/" className="text-primary hover:underline mt-4 inline-block">Back to Home</Link></div>;
  return (
    <article className="max-w-4xl mx-auto bg-white p-6 sm:p-8 lg:p-12 rounded-lg shadow-xl">
      <h1 className="text-4xl md:text-5xl font-extrabold text-neutral mb-4 leading-tight">{post.title}</h1>
      <p className="text-gray-500 mb-8">Posted on {new Date(post.date).toLocaleDateString()}</p>
      <div className="prose lg:prose-xl max-w-none text-gray-800" dangerouslySetInnerHTML={{ __html: post.content }}></div>
      <div className="mt-12 border-t pt-8"><Link to="/" className="text-primary hover:text-secondary font-semibold transition-colors">&larr; Back to all articles</Link></div>
    </article>
  );
};

// --- Admin Login ---
const SECRET_PASSWORD_HASH = 'b4a73070d566c6c9acef7a96f0aeb21f3d408428099d0c8083fabff4fcbd0227'; // 

async function hashSHA256(message) {
  const msgBuffer = new TextEncoder().encode(message);
  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
  return Array.from(new Uint8Array(hashBuffer)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

const AdminLogin = ({onLogin}) => {
  const [password,setPassword]=useState(''); const [error,setError]=useState(''); const [showLogin,setShowLogin]=useState(false); const [seq,setSeq]=useState('');
  
  useEffect(()=>{
    if(showLogin) return;
    let timeoutId;
    const handleKeyDown=(e)=>{
      if(e.key.length>1){ setSeq(''); return; }
      const newSeq = (seq+e.key.toLowerCase()).slice(-10); // length not critical
      setSeq(newSeq);
      if(newSeq==='cricadmin'){ setShowLogin(true); }
      clearTimeout(timeoutId);
      timeoutId=window.setTimeout(()=>setSeq(''),2000);
    };
    window.addEventListener('keydown',handleKeyDown);
    return ()=>{ window.removeEventListener('keydown',handleKeyDown); clearTimeout(timeoutId); };
  },[seq,showLogin]);

  const handleSubmit=async(e)=>{
    e.preventDefault(); setError('');
    try{
      const hash = await hashSHA256(password);
      if(hash===SECRET_PASSWORD_HASH){ onLogin(true); }
      else { setError('Incorrect password.'); onLogin(false); }
    } catch(err){ console.error(err); setError('Error occurred.'); onLogin(false); }
  };

  return showLogin?(
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="max-w-md w-full bg-white p-8 rounded-lg shadow-md">
        <h2 className="text-3xl font-bold text-center text-gray-900 mb-6">Admin Login</h2>
        <form onSubmit={handleSubmit}>
          <div className="mb-4">
            <label className="block text-sm font-medium text-gray-700">Password</label>
            <input type="password" value={password} onChange={e=>setPassword(e.target.value)} required className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" autoFocus />
          </div>
          {error && <p className="text-error text-sm mb-4">{error}</p>}
          <button type="submit" className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-secondary">Login</button>
        </form>
      </div>
    </div>
  ):(
    <div className="text-center text-gray-500">
      <h1 className="text-4xl font-bold mb-4">404</h1>
      <p className="text-xl">Page Not Found</p>
    </div>
  );
};

// --- Admin Layout & Dashboard ---
const AdminLayout = () => {
  const [auth,setAuth]=useState(()=>sessionStorage.getItem('isAdmin')==='true');
  const handleLogin=(success)=>{ if(success){ sessionStorage.setItem('isAdmin','true'); setAuth(true); } };
  const handleLogout=()=>{ sessionStorage.removeItem('isAdmin'); setAuth(false); };
  if(!auth) return <AdminLogin onLogin={handleLogin}/>;
  return (
    <div className="min-h-screen bg-gray-100">
      <header className="bg-white shadow flex justify-between items-center px-4 sm:px-6 lg:px-8 py-4">
        <h1 className="text-2xl font-bold text-gray-900">Admin Panel</h1>
        <button onClick={handleLogout} className="bg-error text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors">Logout</button>
      </header>
      <main className="container mx-auto px-4 sm:px-6 lg:px-8 py-8"><Outlet/></main>
    </div>
  );
};

const AdminDashboard = () => {
  const [posts,setPosts]=useState([]); const [loading,setLoading]=useState(true);
  const fetchPosts=useCallback(async()=>{ setLoading(true); const data=await getPosts(); setPosts(data); setLoading(false); },[]);
  useEffect(()=>{ fetchPosts(); },[fetchPosts]);
  const handleDelete=async(id)=>{ if(window.confirm('Are you sure you want to delete this post?')){ await deletePost(id); fetchPosts(); } };
  if(loading) return <p>Loading posts...</p>;
  return (
    <div className="bg-white p-8 rounded-lg shadow-md">
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-3xl font-bold">Manage Posts</h2>
        <Link to="/admin/new" className="bg-success text-white px-4 py-2 rounded-md hover:bg-green-700">+ New Post</Link>
      </div>
      <div className="overflow-x-auto">
        <table className="min-w-full divide-y divide-gray-200">
          <thead className="bg-gray-50">
            <tr>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Title</th>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
              <th className="relative px-6 py-3"><span className="sr-only">Actions</span></th>
            </tr>
          </thead>
          <tbody className="bg-white divide-y divide-gray-200">
            {posts.map(p=>(
              <tr key={p.id}>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{p.title}</td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{new Date(p.date).toLocaleDateString()}</td>
                <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                  <Link to={`/admin/edit/${p.id}`} className="text-accent hover:text-secondary">Edit</Link>
                  <button onClick={()=>handleDelete(p.id)} className="text-error hover:text-red-700">Delete</button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
};

const PostEditor = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const [title, setTitle] = useState('');
  const [content, setContent] = useState('');
  const [loading, setLoading] = useState(false);
  const isEditing = Boolean(id);
  const editorRef = useRef(null);
  const [isEditorInitialized, setIsEditorInitialized] = useState(false);

  useEffect(() => {
    tinymce.init({
      selector: '#post-content-editor',
      plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount',
      toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | numlist bullist indent outdent | emoticons charmap | removeformat',
      height: 600,
      menubar: false,
      setup: (editor) => {
        editorRef.current = editor;
        editor.on('init', () => {
          setIsEditorInitialized(true);
        });
      }
    });
    return () => {
      tinymce.get('post-content-editor')?.destroy();
    };
  }, []);

  useEffect(() => {
    if (isEditing) {
      setLoading(true);
      getPostById(id).then(post => {
        if (post) {
          setTitle(post.title);
          setContent(post.content);
        }
        setLoading(false);
      });
    } else {
      setTitle('');
      setContent('');
    }
  }, [id, isEditing]);

  useEffect(() => {
    if (isEditorInitialized && editorRef.current) {
      editorRef.current.setContent(content);
    }
  }, [content, isEditorInitialized]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!editorRef.current) return;
    setLoading(true);
    const currentContent = editorRef.current.getContent();
    const postData = { title, content: currentContent };
    try {
      if (isEditing) await updatePost(id, postData);
      else await addPost(postData);
      navigate('/admin');
    } catch (err) {
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  if (loading && isEditing) return <div className="text-center p-8">Loading post...</div>;

  return (
    <div className="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-md">
      <h2 className="text-3xl font-bold mb-6">{isEditing ? 'Edit Post' : 'Create New Post'}</h2>
      <form onSubmit={handleSubmit} className="space-y-6">
        <div>
          <label htmlFor="title" className="block text-sm font-medium text-gray-700">Title</label>
          <input type="text" name="title" id="title" value={title} onChange={(e) => setTitle(e.target.value)} required className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" />
        </div>
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">Content</label>
          <textarea id="post-content-editor"></textarea>
        </div>
        <div>
          <button type="submit" disabled={loading || !isEditorInitialized} className="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:bg-gray-400">
            {loading ? 'Saving...' : (isEditing ? 'Update Post' : 'Create Post')}
          </button>
        </div>
      </form>
    </div>
  );
};


// --- App ---
const App = () => (
  <HashRouter>
    <Header/>
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <Routes>
        <Route path="/" element={<PostList/>}/>
        <Route path="/post/:id" element={<PostDetail/>}/>
        <Route path="/admin" element={<AdminLayout/>}>
          <Route index element={<AdminDashboard/>}/>
          <Route path="new" element={<PostEditor/>}/>
          <Route path="edit/:id" element={<PostEditor/>}/>
        </Route>
        <Route path="*" element={<div className="text-center py-20 text-gray-500"><h1 className="text-4xl font-bold mb-4">404</h1><p>Page Not Found</p></div>}/>
      </Routes>
    </div>
    <Footer/>
  </HashRouter>
);

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App/>);
    </script>
  </body>
</html>